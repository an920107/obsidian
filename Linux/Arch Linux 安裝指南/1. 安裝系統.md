## 1.1 安裝前處理

1. 至 [Arch Linux 下載頁面](https://archlinux.org/download/) 下載映像檔，可使用官方建議的 BitTorrent 或是滑至頁面底端找到相符區域下載 iso 檔

2. 將 iso 燒錄至 USB 隨身碟，根據不同作業系統可選以下不同方式
   
   1. 任意作業系統：使用 [Ventoy](https://www.ventoy.net/en/download.html) 映像檔管理工具
   
   2. Windows：使用 [Refuse](https://rufus.ie/zh_TW/) 開機碟製作工具

3. Linux / macOS：使用 `dd` 指令燒錄開機碟

## 1.2 安裝作業系統

### 1.2.1 透過自動安裝腳本安裝

> 本指南將使用 Arch Linux 自動安裝腳本，若要做更多自定義配置，詳見 [官方中文安裝教學](https://wiki.archlinux.org/title/Installation_guide_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87))

> 強烈建議事先備份原有系統，並做好可能摧毀原有系統的心理準備

1. 以 Arch Linux 開機碟開機

2. 確認網路連接狀態
   
   ```bash
   ping google.com
   ```
   
   > 若使用網路線，網路應為正常連接狀態；若使用 wifi，則使用 `iwctl` 進行連接，詳情見 [[使用 iwctl 連接 wifi]]

3. 執行自動安裝腳本，完成以下設定後選擇 `Install` 即可開始安裝
   
   ```bash
   archinstall
   ```
   
   - **Mirror**
     
     按下 `/` 搜尋 `Taiwan` 並選擇
   
   - **Locales**
     
     先暫時保留預設不用變更
   
   - **Disk configuration**
     
     若是要直接安裝在特定硬碟上，直接選擇 default layout 就行
   
   - **Bootloader**
     
     選擇 `Grub`
   
   - **Swap**
     
     通常現在記憶體夠大，不太需要 swap，除非有休眠的需求 [^1] 
   
     [^1]: 若後續有電腦休眠的需求，等安裝完成後再設定是可以的
   
   - **Hostname**
     
     看自己喜好，系統安裝完成後可修改 `/etc/hostname` 更改
   
   - **Root password**
     
     可以不設置，如此讓 `root` 無法被登入，需要權限的操作只能透過 `sudo` 完成
   
   - **User account**
     
     若沒有設定 **Root password**，此處一定要新增一個 user，且必須為 sudoer
   
   - **Profile** [^2] 
     
     `Type` 的部份選擇 `Desktop` > `Gnome`；顯卡驅動看需求選擇
     
     [^2]: 可以依需求和喜好調整，但後面的環境配置都是以 Gnome 為主
   
   - **Audio**
     
     選擇 `Pipewire`
   
   - **Network configuration**
     
     使用 `NetworkManager`
   
   - **Timezone**
     
     按下 `/` 搜尋 `Taipei` 並選擇

### 1.2.2 安裝遺漏的驅動程式

> 在 [[#1.2 安裝作業系統]] 完成安裝後會詢問是否要 `chroot` 到新系統，須選擇**是**

有些驅動程式是第三方驅動程式，這些在自動安裝時並不會被安裝，[官方文件](https://wiki.archlinux.org/title/Mkinitcpio#Possibly_missing_firmware_for_module_XXXX)有說明這些驅動不一定會被用到，若硬體不需要就不用理會，但如果有強迫症，不喜歡看到任何錯誤訊息，可以根據 `mkinitcpio -p linux` 的錯誤訊息，手動安裝以下套件 [^3] [^4] 

| Module         | Package                                                                                 |
| -------------- | --------------------------------------------------------------------------------------- |
| aic94xx        | [aic94xx-firmware](https://aur.archlinux.org/packages/aic94xx-firmware/) (AUR)          |
| ast            | [ast-firmware](https://aur.archlinux.org/packages/ast-firmware/) (AUR)                  |
| bfa            | [linux-firmware-qlogic](https://archlinux.org/packages/?name=linux-firmware-qlogic)     |
| bnx2x          | [linux-firmware-bnx2x](https://archlinux.org/packages/?name=linux-firmware-bnx2x)       |
| liquidio       | [linux-firmware-liquidio](https://archlinux.org/packages/?name=linux-firmware-liquidio) |
| mlxsw_spectrum | [linux-firmware-mellanox](https://archlinux.org/packages/?name=linux-firmware-mellanox) |
| nfp            | [linux-firmware-nfp](https://archlinux.org/packages/?name=linux-firmware-nfp)           |
| qed            | [linux-firmware-qlogic](https://archlinux.org/packages/?name=linux-firmware-qlogic)     |
| qla1280        | [linux-firmware-qlogic](https://archlinux.org/packages/?name=linux-firmware-qlogic)     |
| qla2xxx        | [linux-firmware-qlogic](https://archlinux.org/packages/?name=linux-firmware-qlogic)     |
| wd719x         | [wd719x-firmware](https://aur.archlinux.org/packages/wd719x-firmware/) (AUR)            |
| xhci_pci       | [upd72020x-fw](https://aur.archlinux.org/packages/upd72020x-fw/) (AUR)                  |

[^3]: 若後方有標注 `AUR` 表示該套件未收錄在官方 pacman 套件管理清單中，安裝方式參見 [[Arch Linux 的套件管理#安裝 AUR 套件|AUR 安裝方式]]

[^4]: 不能以 `root` 安裝 AUR 套件，因此需要以 `su <username>` 切換為其他使用者安裝

### 1.2.3 將 EFI 磁區掛載到其他位置

Arch Linux 預設會將 EFI 磁區掛載至 `/boot`，但若是單顆硬碟上會安裝多個系統，將 EFI 掛載到其他地方會更好，以下為修改步驟（這邊以 `/efi` 作為掛載 EFI 磁區的目標位置）

1. 建立 `/efi` 資料夾
   
   ```bash
   mkdir /efi
   ```

2. 退出 `chroot` 環境，重新掛載 EFI 磁區到 `/efi`，再回到 `chroot` 環境
   
   ```bash
   umount /dev/<efi-partition>
   mount /dev/<efi-partition> /mnt/archinstall/efi
   arch-chroot /mnt/archinstall
   ```

3. 編輯 `/etc/fstab` 檔案，將原本的 `/boot` 更改為 `/efi`

4. 將 `/efi` 除了 `EFI` 資料夾以外的所有內容移動到 `/boot`

5. 生成新的 EFI 開機進入點
   
   ```bash
   grub-install --target=x86_64-efi --efi-directory=/efi --bootloader-id=GRUB
   ```

6. 更新 grub 設定檔
   
   ```bash
   grub-mkconfig -o /boot/grub/grub.cfg
   ```